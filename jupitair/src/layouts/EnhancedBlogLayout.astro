---
import BaseLayout from './BaseLayout.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import Badge from '../components/ui/Badge.astro';
import { Image } from 'astro:assets';

export interface Props {
  frontmatter: {
    title: string;
    description: string;
    author: string;
    publishDate: Date;
    updateDate?: Date;
    heroImage?: string;
    heroImageAlt?: string;
    category: string;
    subcategory?: string;
    tags: string[];
    featured: boolean;
    metaTitle?: string;
    metaDescription?: string;
    primaryKeyword: string;
    secondaryKeywords: string[];
    canonicalURL?: string;
    readingTime?: number;
    tableOfContents?: boolean;
    schemaTypes?: string[];
    ctaText?: string;
    ctaLink?: string;
    relatedPosts?: string[];
    internalLinks?: string[];
    expertReviewer?: string;
    reviewDate?: Date;
    technicalDifficulty?: 'beginner' | 'intermediate' | 'advanced';
    costRange?: string;
    timeEstimate?: string;
    tools?: string[];
    seasonalRelevance?: string[];
  };
}

const { frontmatter } = Astro.props;
const formattedPublishDate = new Date(frontmatter.publishDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
const formattedUpdateDate = frontmatter.updateDate ? new Date(frontmatter.updateDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : null;

// Generate breadcrumb data
const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'HVAC Learning Center', url: '/blog' },
  { name: frontmatter.category, url: `/blog/category/${frontmatter.category.toLowerCase().replace(/\s+/g, '-')}` },
  { name: frontmatter.title, url: '#' }
];

// Enhanced Schema with HowTo and FAQ
const blogSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "@id": frontmatter.canonicalURL || `https://jupitairhvac.com/blog/${frontmatter.title.toLowerCase().replace(/\s+/g, '-')}`,
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": frontmatter.heroImage ? `https://jupitairhvac.com${frontmatter.heroImage}` : "https://jupitairhvac.com/images/default-hvac-blog.jpg",
  "author": {
    "@type": "Organization",
    "name": "Jupitair HVAC",
    "url": "https://jupitairhvac.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jupitairhvac.com/logo.png"
    },
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-940-390-5676",
      "contactType": "customer service",
      "areaServed": ["Plano", "Frisco", "McKinney", "Allen", "The Colony", "Little Elm", "Prosper", "Addison"],
      "availableLanguage": "English"
    }
  },
  "datePublished": frontmatter.publishDate,
  "dateModified": frontmatter.updateDate || frontmatter.publishDate,
  "publisher": {
    "@type": "Organization",
    "name": "Jupitair HVAC",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jupitairhvac.com/logo.png",
      "width": 600,
      "height": 60
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": frontmatter.canonicalURL || `https://jupitairhvac.com/blog/${frontmatter.title.toLowerCase().replace(/\s+/g, '-')}`
  },
  "keywords": [frontmatter.primaryKeyword, ...frontmatter.secondaryKeywords].join(', '),
  "articleSection": frontmatter.category,
  "wordCount": frontmatter.readingTime ? frontmatter.readingTime * 200 : 800,
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".article-summary", ".key-takeaways"]
  },
  "isPartOf": {
    "@type": "Blog",
    "name": "Jupitair HVAC Learning Center",
    "url": "https://jupitairhvac.com/blog"
  }
};

// Review schema if expert reviewed
const reviewSchema = frontmatter.expertReviewer ? {
  "@context": "https://schema.org",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Article",
    "name": frontmatter.title
  },
  "author": {
    "@type": "Person",
    "name": frontmatter.expertReviewer
  },
  "reviewBody": "This article has been technically reviewed for accuracy",
  "datePublished": frontmatter.reviewDate || frontmatter.updateDate || frontmatter.publishDate
} : null;

// Breadcrumb schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((crumb, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": crumb.name,
    "item": crumb.url === '#' ? undefined : `https://jupitairhvac.com${crumb.url}`
  }))
};

// Determine difficulty color
const difficultyColor = {
  'beginner': 'success',
  'intermediate': 'warning',
  'advanced': 'emergency'
}[frontmatter.technicalDifficulty || 'beginner'];
---

<BaseLayout 
  title={frontmatter.metaTitle || `${frontmatter.title} | Jupitair HVAC Expert Guide`}
  description={frontmatter.metaDescription || frontmatter.description}
  keywords={[frontmatter.primaryKeyword, ...frontmatter.secondaryKeywords].join(', ')}
  canonical={frontmatter.canonicalURL}
>
  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  {reviewSchema && (
    <script type="application/ld+json" set:html={JSON.stringify(reviewSchema)} />
  )}

  <article class="max-w-7xl mx-auto px-4 py-8 lg:py-12">
    <!-- Breadcrumbs -->
    <nav class="mb-6" aria-label="Breadcrumb">
      <ol class="flex flex-wrap items-center gap-2 text-sm">
        {breadcrumbs.map((crumb, index) => (
          <>
            {index > 0 && <span class="text-gray-400" aria-hidden="true">›</span>}
            {crumb.url === '#' ? (
              <li class="text-gray-600 font-medium truncate max-w-[200px]" title={crumb.name}>
                {crumb.name}
              </li>
            ) : (
              <li>
                <a 
                  href={crumb.url} 
                  class="text-primary-600 hover:text-primary-700 hover:underline transition-colors"
                  aria-label={`Navigate to ${crumb.name}`}
                >
                  {crumb.name}
                </a>
              </li>
            )}
          </>
        ))}
      </ol>
    </nav>

    <!-- Article Header -->
    <header class="mb-8 lg:mb-12">
      <!-- Category Badges -->
      <div class="flex flex-wrap gap-2 mb-4">
        <Badge variant="primary">{frontmatter.category}</Badge>
        {frontmatter.subcategory && (
          <Badge variant="secondary">{frontmatter.subcategory}</Badge>
        )}
        {frontmatter.featured && (
          <Badge variant="emergency">Featured Guide</Badge>
        )}
        {frontmatter.technicalDifficulty && (
          <Badge variant={difficultyColor as any}>
            {frontmatter.technicalDifficulty} Level
          </Badge>
        )}
      </div>
      
      <!-- Title -->
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4 leading-tight">
        {frontmatter.title}
      </h1>
      
      <!-- Description -->
      <p class="text-lg sm:text-xl text-gray-700 mb-6 leading-relaxed article-summary">
        {frontmatter.description}
      </p>
      
      <!-- Meta Information -->
      <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-600 border-t border-b border-gray-200 py-4">
        <!-- Author -->
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
          </svg>
          <span>By <strong>{frontmatter.author}</strong></span>
        </div>
        
        <!-- Publish Date -->
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
          </svg>
          <time datetime={frontmatter.publishDate.toISOString()}>
            {formattedPublishDate}
          </time>
        </div>
        
        <!-- Update Date -->
        {formattedUpdateDate && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
            </svg>
            <span>Updated: {formattedUpdateDate}</span>
          </div>
        )}
        
        <!-- Reading Time -->
        {frontmatter.readingTime && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            <span>{frontmatter.readingTime} min read</span>
          </div>
        )}
        
        <!-- Expert Review -->
        {frontmatter.expertReviewer && (
          <div class="flex items-center gap-2 text-primary-600">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span>Expert Verified</span>
          </div>
        )}
      </div>

      <!-- Quick Info Cards -->
      {(frontmatter.costRange || frontmatter.timeEstimate || frontmatter.tools) && (
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6">
          {frontmatter.costRange && (
            <Card variant="outline" size="sm" class="text-center">
              <div class="text-gray-600 text-sm mb-1">Estimated Cost</div>
              <div class="text-lg font-bold text-gray-900">{frontmatter.costRange}</div>
            </Card>
          )}
          {frontmatter.timeEstimate && (
            <Card variant="outline" size="sm" class="text-center">
              <div class="text-gray-600 text-sm mb-1">Time Required</div>
              <div class="text-lg font-bold text-gray-900">{frontmatter.timeEstimate}</div>
            </Card>
          )}
          {frontmatter.tools && frontmatter.tools.length > 0 && (
            <Card variant="outline" size="sm" class="text-center">
              <div class="text-gray-600 text-sm mb-1">Tools Needed</div>
              <div class="text-lg font-bold text-gray-900">{frontmatter.tools.length} items</div>
            </Card>
          )}
        </div>
      )}
    </header>

    <!-- Hero Image -->
    {frontmatter.heroImage && (
      <div class="mb-8 lg:mb-12 rounded-2xl overflow-hidden shadow-xl bg-gray-100">
        <img 
          src={frontmatter.heroImage} 
          alt={frontmatter.heroImageAlt || frontmatter.title}
          class="w-full h-auto object-cover"
          loading="eager"
          width="1200"
          height="630"
        />
      </div>
    )}

    <!-- Key Takeaways Box -->
    <Card variant="elevated" size="lg" class="mb-8 lg:mb-12 bg-gradient-to-br from-primary-50 to-white border-primary-200 key-takeaways">
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0">
          <svg class="w-8 h-8 text-primary-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="flex-1">
          <h2 class="text-xl font-bold text-gray-900 mb-3">Key Takeaways</h2>
          <div id="key-takeaways-content" class="prose prose-sm text-gray-700">
            <!-- This will be populated by the content -->
          </div>
        </div>
      </div>
    </Card>

    <!-- Table of Contents -->
    {frontmatter.tableOfContents && (
      <Card variant="elevated" size="lg" class="mb-8 lg:mb-12 sticky-toc lg:float-right lg:ml-8 lg:w-80">
        <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          Table of Contents
        </h2>
        <div id="toc" class="space-y-2 max-h-96 overflow-y-auto">
          <!-- TOC will be generated by client-side script -->
        </div>
      </Card>
    )}

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-12 gap-8 lg:gap-12">
      <!-- Article Content -->
      <div class="lg:col-span-8">
        <div class="prose prose-lg max-w-none 
          prose-headings:font-bold prose-headings:text-gray-900 
          prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:mt-8 prose-h2:mb-4 prose-h2:border-b prose-h2:border-gray-200 prose-h2:pb-2
          prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 prose-h3:mb-3 
          prose-h4:text-lg sm:prose-h4:text-xl prose-h4:mt-4 prose-h4:mb-2
          prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-4
          prose-a:text-primary-600 hover:prose-a:text-primary-700 prose-a:underline prose-a:font-medium
          prose-strong:text-gray-900 prose-strong:font-semibold
          prose-ul:my-4 prose-ol:my-4 
          prose-li:my-1 prose-li:text-gray-700 prose-li:leading-relaxed
          prose-blockquote:border-l-4 prose-blockquote:border-primary-500 prose-blockquote:bg-primary-50 prose-blockquote:pl-4 prose-blockquote:pr-4 prose-blockquote:py-2 prose-blockquote:italic prose-blockquote:text-gray-700 prose-blockquote:my-6
          prose-code:bg-gray-100 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:text-gray-800 prose-code:font-mono
          prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:overflow-x-auto prose-pre:rounded-lg prose-pre:p-4
          prose-table:w-full prose-table:border-collapse 
          prose-th:bg-gray-100 prose-th:text-left prose-th:font-semibold prose-th:p-3 prose-th:border prose-th:border-gray-300
          prose-td:border prose-td:border-gray-300 prose-td:p-3
          prose-img:rounded-lg prose-img:shadow-lg prose-img:mx-auto">
          <slot />
        </div>

        <!-- Tools Required Section -->
        {frontmatter.tools && frontmatter.tools.length > 0 && (
          <Card variant="outline" size="lg" class="mt-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              Tools & Equipment Required
            </h3>
            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              {frontmatter.tools.map(tool => (
                <li class="flex items-center gap-2 text-gray-700">
                  <svg class="w-4 h-4 text-primary-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  {tool}
                </li>
              ))}
            </ul>
          </Card>
        )}

        <!-- Author Bio Box -->
        <Card variant="elevated" size="lg" class="mt-8 bg-gradient-to-br from-gray-50 to-white">
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0">
              <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-primary-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                </svg>
              </div>
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-gray-900 mb-1">About the Author</h3>
              <p class="text-sm text-gray-600 mb-2">{frontmatter.author}</p>
              <p class="text-gray-700">
                The Jupitair HVAC Team consists of NATE-certified technicians and comfort specialists with over 15 years of experience serving North Texas. 
                We're committed to providing honest, expert advice to help homeowners make informed decisions about their heating and cooling systems.
              </p>
              {frontmatter.expertReviewer && (
                <p class="text-sm text-primary-600 mt-2">
                  <strong>Technical Review:</strong> {frontmatter.expertReviewer}
                </p>
              )}
            </div>
          </div>
        </Card>

        <!-- Tags -->
        {frontmatter.tags && frontmatter.tags.length > 0 && (
          <div class="mt-8">
            <h3 class="font-bold text-gray-900 mb-3">Related Topics:</h3>
            <div class="flex flex-wrap gap-2">
              {frontmatter.tags.map(tag => (
                <a 
                  href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, '-')}`}
                  class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors"
                  aria-label={`View articles tagged with ${tag}`}
                >
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                  </svg>
                  {tag}
                </a>
              ))}
            </div>
          </div>
        )}
      </div>

      <!-- Sidebar -->
      <aside class="lg:col-span-4">
        <div class="sticky top-24 space-y-6">
          <!-- Emergency CTA -->
          <Card variant="elevated" size="lg" class="bg-gradient-to-br from-emergency-50 to-white border-emergency-200">
            <div class="text-center">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-emergency-100 rounded-full mb-4">
                <svg class="w-8 h-8 text-emergency-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">Need Emergency Service?</h3>
              <p class="text-gray-700 mb-4">
                24/7 emergency HVAC service available throughout North Texas
              </p>
              <Button 
                href="tel:9403905676" 
                variant="emergency" 
                size="lg" 
                class="w-full justify-center mb-3"
                ariaLabel="Call for emergency HVAC service"
              >
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                </svg>
                Call (940) 390-5676
              </Button>
              <p class="text-xs text-gray-600">
                Average response time: 45 minutes
              </p>
            </div>
          </Card>

          <!-- Schedule Service CTA -->
          <Card variant="elevated" size="lg" class="bg-gradient-to-br from-primary-50 to-white">
            <h3 class="text-lg font-bold text-gray-900 mb-3">Schedule Service</h3>
            <p class="text-gray-700 mb-4">
              Get professional HVAC service from certified technicians
            </p>
            <div class="space-y-3">
              <Button 
                href="/schedule" 
                variant="primary" 
                size="md" 
                class="w-full justify-center"
                ariaLabel="Schedule HVAC service online"
              >
                Book Online
              </Button>
              <Button 
                href="/contact" 
                variant="outline" 
                size="md" 
                class="w-full justify-center"
                ariaLabel="Get a free HVAC estimate"
              >
                Get Free Estimate
              </Button>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200">
              <div class="flex items-center gap-2 text-sm text-gray-600">
                <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                Licensed & Insured
              </div>
              <div class="flex items-center gap-2 text-sm text-gray-600 mt-1">
                <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                Satisfaction Guaranteed
              </div>
              <div class="flex items-center gap-2 text-sm text-gray-600 mt-1">
                <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                Upfront Pricing
              </div>
            </div>
          </Card>

          <!-- Related Posts -->
          {frontmatter.relatedPosts && frontmatter.relatedPosts.length > 0 && (
            <Card variant="default" size="lg">
              <h3 class="text-lg font-bold text-gray-900 mb-4">Related Guides</h3>
              <ul class="space-y-3">
                {frontmatter.relatedPosts.slice(0, 5).map(post => (
                  <li>
                    <a 
                      href={`/blog/${post}`}
                      class="group flex items-start gap-2 text-primary-600 hover:text-primary-700"
                    >
                      <svg class="w-4 h-4 mt-0.5 flex-shrink-0 group-hover:translate-x-1 transition-transform" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                      </svg>
                      <span class="hover:underline">
                        {post.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                      </span>
                    </a>
                  </li>
                ))}
              </ul>
            </Card>
          )}

          <!-- Service Areas -->
          <Card variant="default" size="md">
            <h3 class="text-lg font-bold text-gray-900 mb-3">Service Areas</h3>
            <div class="grid grid-cols-2 gap-2 text-sm">
              {['Plano', 'Frisco', 'McKinney', 'Allen', 'The Colony', 'Little Elm', 'Prosper', 'Addison'].map(city => (
                <a 
                  href={`/${city.toLowerCase().replace(/\s+/g, '-')}`}
                  class="text-primary-600 hover:text-primary-700 hover:underline"
                >
                  {city}
                </a>
              ))}
            </div>
          </Card>
        </div>
      </aside>
    </div>

    <!-- Newsletter Signup -->
    <section class="mt-16 bg-gradient-to-r from-primary-600 to-primary-700 rounded-2xl p-8 lg:p-12 text-white">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-2xl lg:text-3xl font-bold mb-4">Stay Informed with HVAC Tips</h2>
        <p class="text-lg mb-8 text-primary-100">
          Get monthly maintenance reminders, energy-saving tips, and exclusive offers delivered to your inbox.
        </p>
        <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto" aria-label="Newsletter signup">
          <input 
            type="email" 
            placeholder="Enter your email" 
            class="flex-1 px-4 py-3 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white"
            required
            aria-label="Email address"
          />
          <Button 
            type="submit" 
            variant="secondary" 
            size="lg"
            class="whitespace-nowrap"
          >
            Subscribe Now
          </Button>
        </form>
        <p class="text-xs text-primary-200 mt-4">
          We respect your privacy. Unsubscribe anytime.
        </p>
      </div>
    </section>

    <!-- Bottom CTA -->
    <Card variant="elevated" size="lg" class="mt-12 bg-gradient-to-br from-primary-50 to-white border-primary-200">
      <div class="text-center">
        <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-4">
          Ready to Solve Your HVAC Challenges?
        </h2>
        <p class="text-lg text-gray-700 mb-6 max-w-2xl mx-auto">
          Don't let HVAC issues disrupt your comfort. Our experienced technicians are ready to provide expert solutions tailored to your needs.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href="tel:9403905676" variant="primary" size="lg" class="justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            Call (940) 390-5676
          </Button>
          <Button href="/contact" variant="outline" size="lg" class="justify-center">
            Get Free Estimate
          </Button>
        </div>
        <p class="text-sm text-gray-600 mt-6">
          ⭐⭐⭐⭐⭐ 4.9/5 based on 500+ Google Reviews
        </p>
      </div>
    </Card>
  </article>

  <!-- Footer Disclaimer -->
  <footer class="max-w-7xl mx-auto px-4 py-8 mt-12 border-t border-gray-200">
    <div class="text-sm text-gray-600 space-y-2">
      <p>
        <strong>Last Updated:</strong> {formattedUpdateDate || formattedPublishDate} | 
        <strong>License:</strong> TACLA #123456
      </p>
      <p>
        Jupitair HVAC serves all of North Texas including Plano, Frisco, McKinney, Allen, The Colony, Little Elm, Prosper, and Addison. 
        The information provided in this article is for educational purposes only. For specific HVAC issues, please consult with a licensed professional.
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Generate Table of Contents
      const tocContainer = document.getElementById('toc');
      const headings = document.querySelectorAll('.prose h2, .prose h3');
      
      if (tocContainer && headings.length > 0) {
        const tocList = document.createElement('ul');
        tocList.className = 'space-y-2';
        
        headings.forEach((heading, index) => {
          const id = heading.id || `heading-${index}`;
          heading.id = id;
          
          const li = document.createElement('li');
          li.className = heading.tagName === 'H3' ? 'ml-4 text-sm' : 'font-medium';
          
          const link = document.createElement('a');
          link.href = `#${id}`;
          link.textContent = heading.textContent;
          link.className = 'text-gray-700 hover:text-primary-600 hover:underline transition-colors block py-1';
          
          // Smooth scroll
          link.addEventListener('click', (e) => {
            e.preventDefault();
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
          
          li.appendChild(link);
          tocList.appendChild(li);
        });
        
        tocContainer.appendChild(tocList);
      }

      // Extract Key Takeaways
      const keyTakeawaysContent = document.getElementById('key-takeaways-content');
      if (keyTakeawaysContent) {
        const firstList = document.querySelector('.prose ul, .prose ol');
        if (firstList) {
          const takeawaysList = firstList.cloneNode(true);
          takeawaysList.className = 'space-y-2';
          keyTakeawaysContent.appendChild(takeawaysList);
        } else {
          // Fallback: Extract first paragraph
          const firstParagraph = document.querySelector('.prose p');
          if (firstParagraph) {
            keyTakeawaysContent.innerHTML = firstParagraph.innerHTML;
          }
        }
      }

      // Track scroll depth
      let maxScroll = 0;
      window.addEventListener('scroll', () => {
        const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
        if (scrollPercent > maxScroll) {
          maxScroll = scrollPercent;
          if (maxScroll > 25 && maxScroll <= 26) {
            console.log('User scrolled 25%');
          } else if (maxScroll > 50 && maxScroll <= 51) {
            console.log('User scrolled 50%');
          } else if (maxScroll > 75 && maxScroll <= 76) {
            console.log('User scrolled 75%');
          } else if (maxScroll > 90) {
            console.log('User completed article');
          }
        }
      });
    });
  </script>

  <style>
    /* Custom styles for enhanced blog layout */
    .sticky-toc {
      @media (min-width: 1024px) {
        position: sticky;
        top: 6rem;
        max-height: calc(100vh - 8rem);
        overflow-y: auto;
      }
    }

    /* Improve readability */
    .prose {
      font-feature-settings: "kern" 1;
      text-rendering: optimizeLegibility;
    }

    /* Enhanced blockquotes */
    .prose blockquote {
      position: relative;
      padding-left: 2rem;
    }

    .prose blockquote::before {
      content: '"';
      position: absolute;
      left: 0;
      top: -0.5rem;
      font-size: 3rem;
      color: rgb(59 130 246 / 0.3);
      font-family: Georgia, serif;
    }

    /* Code block enhancements */
    .prose pre {
      position: relative;
    }

    .prose pre::before {
      content: attr(data-language);
      position: absolute;
      top: 0;
      right: 0;
      padding: 0.25rem 0.5rem;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 0.75rem;
      border-bottom-left-radius: 0.25rem;
    }

    /* Table improvements */
    .prose table {
      font-size: 0.875rem;
    }

    .prose tbody tr:nth-child(even) {
      background-color: rgb(249 250 251);
    }

    /* Print styles */
    @media print {
      .sticky-toc,
      aside,
      form,
      .no-print {
        display: none !important;
      }

      .prose {
        max-width: 100% !important;
      }
    }
  </style>
</BaseLayout>