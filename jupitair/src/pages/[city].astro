---
import BaseLayout from '../layouts/BaseLayout.astro';
import PremiumHero from '../components/layout/PremiumHero.astro';
import PremiumButton from '../components/ui/PremiumButton.astro';
import PremiumCard from '../components/ui/PremiumCard.astro';
import Button from '../components/ui/Button.astro';
import Card from '../components/ui/Card.astro';
import Badge from '../components/ui/Badge.astro';
import Icon from '../components/ui/Icon.astro';
import DynamicSchema from '../components/seo/DynamicSchema.astro';
import ReviewsSection from '../components/reviews/ReviewsSection.astro';
import { readFileSync } from 'fs';
import { parse } from 'yaml';

export async function getStaticPaths() {
  // Load cities data
  const citiesData = parse(readFileSync('./data/cities.yml', 'utf8'));
  const servicesData = parse(readFileSync('./data/services.yml', 'utf8'));
  
  return (citiesData?.cities || []).map((city: any) => ({
    params: { city: city.slug },
    props: { city, services: servicesData?.money_pages || [] }
  }));
}

const { city, services } = Astro.props;
const pageTitle = `HVAC Services ${city.name}, TX | Jupitair HVAC - AC Repair & Installation`;
const pageDescription = `Professional HVAC contractor serving ${city.name}, Texas. AC repair, heating services, HVAC installation, and emergency service. Licensed technicians, upfront pricing, 24/7 availability.`;

// City-specific schema
const citySchema = {
  "@type": ["LocalBusiness", "HVACBusiness"],
  "name": `Jupitair HVAC - ${city.name}`,
  "description": city.description,
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": city.coordinates.lat,
    "longitude": city.coordinates.lng
  },
  "areaServed": {
    "@type": "City",
    "name": city.name,
    "addressRegion": "TX"
  }
};
---

<BaseLayout 
  title={pageTitle}
  description={pageDescription}
  canonical={`https://jupitairhvac.com/${city.slug}`}
  keywords={`${(city.keywords || []).join(', ')}, ${city.name} HVAC`}
>
  <!-- Dynamic Schema with Reviews -->
  <DynamicSchema type="city" city={city.name} />
  
  <!-- Premium Hero Section with Emergency Banner -->
  <PremiumHero 
    title={`Premier HVAC Services in ${city.name}, TX`}
    subtitle="Your Trusted Local HVAC Experts"
    description={`Professional heating and cooling services for ${city.name} residents. Same-day service, 24/7 emergency response, and satisfaction guaranteed.`}
    ctaPrimary={{ text: "Call (940) 390-5676", href: "tel:9403905676" }}
    ctaSecondary={{ text: "Schedule Online", href: "/schedule" }}
    variant="gradient"
    height="lg"
    emergency={true}
  />

  <!-- Trust Bar -->
  <section class="bg-gradient-to-r from-gray-900 to-gray-800 py-4">
    <div class="container mx-auto px-4">
      <div class="flex flex-wrap justify-center items-center gap-6 text-sm">
        <div class="flex items-center gap-2 text-white">
          <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span>Licensed & Insured</span>
        </div>
        <div class="flex items-center gap-2 text-white">
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
          <span>5.0 Star Rating</span>
        </div>
        <div class="flex items-center gap-2 text-white">
          <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          <span>Same-Day Service</span>
        </div>
        <div class="flex items-center gap-2 text-white">
          <svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
          </svg>
          <span>24/7 Emergency</span>
        </div>
      </div>
    </div>
  </section>

  <div class="container mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 max-w-7xl py-12 sm:py-16 lg:py-20">

    <!-- Services Section with Enterprise Design -->
    <section class="mb-16">
      <div class="text-center mb-12">
        <Badge variant="primary" class="mb-4">Our Services</Badge>
        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
          Professional HVAC Services in {city.name}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          From emergency repairs to new installations, we provide comprehensive HVAC solutions for {city.name} homes and businesses
        </p>
      </div>
      
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {services.slice(0, 9).map((service: any) => (
          <PremiumCard variant="elevated" padding="lg" hover={true} class="group h-full flex flex-col">
            <div class="mb-4">
              <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  {service.category === 'cooling' ? (
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                  ) : service.category === 'heating' ? (
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                  ) : service.emergency ? (
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  ) : (
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  )}
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
                {service.name}
              </h3>
              <p class="text-gray-600 text-sm line-clamp-2">{service.shortDescription}</p>
            </div>
            
            <div class="mt-auto space-y-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-gray-500">Starting at</p>
                  <p class="text-2xl font-bold text-gray-900">${service.pricing.starting}</p>
                </div>
                {service.emergency && (
                  <Badge variant="emergency">24/7 Available</Badge>
                )}
              </div>
              
              <div class="pt-4 border-t border-gray-200 space-y-2">
                <PremiumButton 
                  href={`/${city.slug}/${service.slug}`} 
                  variant="premium" 
                  size="sm" 
                  class="w-full justify-center"
                >
                  View Details →
                </PremiumButton>
                <Button 
                  href="tel:9403905676" 
                  variant="outline" 
                  size="sm" 
                  class="w-full justify-center"
                >
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                  </svg>
                  Call Now
                </Button>
              </div>
            </div>
          </PremiumCard>
        ))}
      </div>
      
      <div class="text-center mt-8">
        <Button href="/services" variant="primary" size="lg">
          View All Services →
        </Button>
      </div>
    </section>

    <!-- Why Choose Us Section -->
    <section class="py-16 bg-gradient-to-br from-gray-50 to-white rounded-3xl mb-16">
      <div class="px-8">
        <div class="text-center mb-12">
          <Badge variant="secondary" class="mb-4">Why Choose Us</Badge>
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            Your Trusted {city.name} HVAC Experts
          </h2>
          <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            With 15+ years serving {city.name}, we understand your unique heating and cooling needs
          </p>
        </div>
        
        <div class="grid md:grid-cols-3 gap-8">
          <PremiumCard variant="glass" padding="lg">
            <div class="text-center">
              <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">Licensed & Insured</h3>
              <p class="text-gray-600">Fully licensed HVAC contractors with $2M liability insurance</p>
            </div>
          </PremiumCard>
          
          <PremiumCard variant="glass" padding="lg">
            <div class="text-center">
              <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">Fast Response</h3>
              <p class="text-gray-600">Same-day service and 24/7 emergency response in {city.name}</p>
            </div>
          </PremiumCard>
          
          <PremiumCard variant="glass" padding="lg">
            <div class="text-center">
              <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">Satisfaction Guarantee</h3>
              <p class="text-gray-600">100% satisfaction guarantee with 90-day warranty on all repairs</p>
            </div>
          </PremiumCard>
        </div>
        
        <!-- Stats Bar -->
        <div class="mt-12 grid grid-cols-2 md:grid-cols-4 gap-6 p-8 bg-white rounded-2xl shadow-lg">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">15+</div>
            <div class="text-sm text-gray-600">Years Experience</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">{city.population > 50000 ? '1000+' : '500+'}</div>
            <div class="text-sm text-gray-600">{city.name} Customers</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">24/7</div>
            <div class="text-sm text-gray-600">Emergency Service</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">5.0</div>
            <div class="text-sm text-gray-600">Star Rating</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Emergency CTA Section -->
    <section class="relative py-20 bg-gradient-to-br from-red-600 via-red-700 to-red-800 rounded-3xl overflow-hidden mb-16">
      <div class="absolute inset-0 opacity-10">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-white rounded-full"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-white rounded-full"></div>
      </div>
      <div class="relative z-10 text-center max-w-4xl mx-auto px-8">
        <Badge variant="light" class="mb-4 bg-white/20 text-white border-white/30">
          24/7 Emergency Service
        </Badge>
        <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">
          HVAC Emergency in {city.name}?
        </h2>
        <p class="text-xl md:text-2xl text-red-100 mb-8">
          Don't suffer in the Texas heat or cold. We're here 24/7 with fast, reliable emergency service.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <PremiumButton 
            href="tel:9403905676" 
            variant="premium"
            size="xl"
            class="bg-white text-red-700 hover:bg-gray-100 shadow-2xl min-w-[250px]"
          >
            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
            </svg>
            Call (940) 390-5676
          </PremiumButton>
          <PremiumButton 
            href="/schedule" 
            variant="glass"
            size="xl"
            class="border-2 border-white text-white hover:bg-white hover:text-red-700 min-w-[250px]"
          >
            Schedule Online
          </PremiumButton>
        </div>
        <p class="text-sm text-red-100 mt-6">Average response time in {city.name}: 45 minutes</p>
      </div>
    </section>
    
    <!-- Reviews Section -->
    <ReviewsSection 
      limit={6}
      variant="grid"
      title={`What ${city.name} Residents Say About Us`}
    />
    
    <!-- Service Area Info -->
    <section class="py-16">
      <PremiumCard variant="elevated" padding="xl">
        <div class="grid md:grid-cols-2 gap-12">
          <div>
            <h3 class="text-2xl font-bold text-gray-900 mb-6">
              Serving {city.name} & Surrounding Areas
            </h3>
            <div class="space-y-4 mb-6">
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <div>
                  <p class="font-semibold text-gray-900">Coverage Area</p>
                  <p class="text-gray-600">{city.serviceRadius} mile radius from {city.name} city center</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div>
                  <p class="font-semibold text-gray-900">Response Time</p>
                  <p class="text-gray-600">Same-day service for most repairs in {city.name}</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                <div>
                  <p class="font-semibold text-gray-900">Local Office</p>
                  <p class="text-gray-600">Technicians based right here in North Texas</p>
                </div>
              </div>
            </div>
            <Button href="/contact" variant="primary" size="lg">
              Get Service in {city.name} →
            </Button>
          </div>
          
          <div>
            <h3 class="text-2xl font-bold text-gray-900 mb-6">
              {city.name} Quick Facts
            </h3>
            <div class="bg-gray-50 rounded-xl p-6 space-y-4">
              <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <span class="text-gray-600">Population</span>
                <span class="font-semibold text-gray-900">{city.population.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <span class="text-gray-600">County</span>
                <span class="font-semibold text-gray-900">{city.county}</span>
              </div>
              <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <span class="text-gray-600">Median Home Age</span>
                <span class="font-semibold text-gray-900">{city.demographics.avgHomeAge} years</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Climate Zone</span>
                <span class="font-semibold text-gray-900">Hot-Humid (3A)</span>
              </div>
            </div>
            <p class="text-sm text-gray-600 mt-4">
              Understanding {city.name}'s unique climate helps us provide the right HVAC solutions for your home.
            </p>
          </div>
        </div>
      </PremiumCard>
    </section>

    <!-- Final CTA -->
    <section class="py-16 bg-gradient-to-r from-blue-600 to-blue-700 rounded-3xl text-white text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        Ready to Experience Premium HVAC Service in {city.name}?
      </h2>
      <p class="text-xl mb-8 text-blue-100 max-w-2xl mx-auto">
        Join thousands of satisfied customers who trust Jupitair HVAC for their heating and cooling needs
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <PremiumButton 
          href="tel:9403905676" 
          variant="premium"
          size="lg"
          class="bg-white text-blue-600 hover:bg-gray-100 min-w-[200px]"
        >
          Call Now
        </PremiumButton>
        <PremiumButton 
          href="/schedule" 
          variant="glass"
          size="lg"
          class="border-2 border-white text-white hover:bg-white hover:text-blue-600 min-w-[200px]"
        >
          Schedule Service
        </PremiumButton>
      </div>
    </section>
  </div>
</BaseLayout>