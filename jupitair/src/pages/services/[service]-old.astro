---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Button from '../../components/ui/Button.astro';
import Card from '../../components/ui/Card.astro';
import Badge from '../../components/ui/Badge.astro';
import ReviewsSection from '../../components/reviews/ReviewsSection.astro';
import { readFileSync } from 'fs';
import { parse } from 'yaml';

export async function getStaticPaths() {
  const servicesData = parse(readFileSync('./data/services-new.yml', 'utf8'));
  
  return servicesData.money_pages.map((service: any) => ({
    params: { service: service.slug },
    props: { service }
  }));
}

const { service } = Astro.props;


// Schema.org data
const serviceSchema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": service.title,
  "description": service.description,
  "provider": {
    "@type": "HVACBusiness",
    "name": "Jupitair HVAC",
    "telephone": "(940) 390-5676",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "5760 Legacy Dr B3-501",
      "addressLocality": "Plano", 
      "addressRegion": "TX",
      "postalCode": "75024"
    }
  },
  "areaServed": [
    "Frisco, TX", "Plano, TX", "McKinney, TX", "Allen, TX", 
    "Prosper, TX", "The Colony, TX", "Little Elm, TX", "Addison, TX"
  ],
  "serviceType": service.name,
  "offers": {
    "@type": "Offer",
    "priceRange": `$${service.pricing.starting}+`,
    "description": service.pricing.note
  }
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://jupitairhvac.com/"
    },
    {
      "@type": "ListItem", 
      "position": 2,
      "name": "Services",
      "item": "https://jupitairhvac.com/services"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": service.title,
      "item": `https://jupitairhvac.com/services/${service.slug}`
    }
  ]
};

// FAQ data for services with FAQPage schema
const faqData = service.schema?.includes('FAQPage') ? [
  {
    question: `How much does ${service.name.toLowerCase()} cost?`,
    answer: `${service.name} starts at $${service.pricing.starting}. ${service.pricing.note}. We provide upfront pricing before any work begins.`
  },
  {
    question: `How long does ${service.name.toLowerCase()} take?`,
    answer: `${service.service_time}. We work efficiently to minimize disruption while ensuring quality workmanship.`
  },
  {
    question: `Do you offer a warranty on ${service.name.toLowerCase()}?`,
    answer: `Yes, we provide ${service.warranty}. All work is backed by our satisfaction guarantee.`
  }
] : null;

const faqSchema = faqData ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqData.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
} : null;
---

<BaseLayout 
  title={pageTitle} 
  description={pageDescription}
  canonical={`https://jupitairhvac.com/services/${service.slug}`}
  keywords={`${service.keywords.join(', ')}, North Texas ${service.name}`}
  schema={serviceSchema}
>
  <div class="container mx-auto px-4 py-8">
    <!-- Hero Section -->
    <section class="hero bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16 px-6 sm:px-8 lg:px-12 mb-12 rounded-lg">
      <div class="text-center max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-6xl font-bold mb-4">
          {service.title} in North Texas
        </h1>
        <p class="text-xl md:text-2xl mb-8">
          {service.description}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <Button href="tel:(940) 390-5676" variant="emergency" size="xl" class="w-full sm:w-auto min-w-[200px] max-w-[280px] justify-center">
            Call (940) 390-5676
          </Button>
          <Button href="/contact" size="xl" class="w-full sm:w-auto min-w-[200px] max-w-[280px] justify-center border-2 border-white text-white bg-transparent hover:bg-white/20 hover:border-white hover:text-white">
            Get Free Estimate
          </Button>
        </div>
      </div>
    </section>

    <!-- Service Details -->
    <section class="mb-12">
      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <h2 class="text-3xl font-bold text-gray-900 mb-6">
            Professional {service.title}
          </h2>
          <p class="text-gray-600 mb-6 text-lg leading-relaxed">
            {service.description}
          </p>
          
          <div class="bg-blue-50 p-6 rounded-lg mb-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Service Highlights</h3>
            <ul class="space-y-2 text-gray-700">
              <li>✓ {service.serviceTime}</li>
              <li>✓ {service.warranty}</li>
              <li>✓ Upfront Pricing - No Hidden Fees</li>
              <li>✓ Licensed & Insured Technicians</li>
              {service.emergency && <li>✓ 24/7 Emergency Service Available</li>}
            </ul>
          </div>
        </div>
        
        <div>
          <div class="bg-white p-6 rounded-lg shadow-md border">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Service Information</h3>
            <div class="space-y-4">
              <div>
                <span class="font-medium text-gray-700">Starting Price:</span>
                <span class="text-2xl font-bold text-primary-700 ml-2">${service.pricing.starting}</span>
              </div>
              <div>
                <span class="font-medium text-gray-700">Average Cost:</span>
                <span class="text-lg text-gray-900 ml-2">${service.pricing.average}</span>
              </div>
              <p class="text-sm text-gray-600">{service.pricing.description}</p>
              
              <div class="pt-4 border-t">
                <span class="font-medium text-gray-700">Service Time:</span>
                <p class="text-gray-900">{service.serviceTime}</p>
              </div>
              
              <div class="pt-4 border-t">
                <span class="font-medium text-gray-700">Warranty:</span>
                <p class="text-gray-900">{service.warranty}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Service Areas -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
        {service.title} Service Areas
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        {cities.map((city: any) => (
          <div class="bg-white p-4 rounded-lg shadow-md border hover:shadow-lg transition-shadow">
            <h3 class="font-semibold text-gray-900 mb-2">
              <a href={`/${city.slug}/${service.slug}`} class="hover:text-blue-600">
                {city.name}, TX
              </a>
            </h3>
            <p class="text-sm text-gray-600">
              Population: {city.population.toLocaleString()}
            </p>
            <p class="text-sm text-blue-600 mt-2">
              View {service.name} in {city.name} →
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Process Section -->
    <section class="bg-gray-50 p-8 rounded-lg mb-12">
      <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
        Our {service.title} Process
      </h2>
      <div class="grid md:grid-cols-4 gap-6">
        <div class="text-center">
          <div class="bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4 text-xl font-bold">
            1
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Schedule Service</h3>
          <p class="text-gray-600 text-sm">Call us or fill out our online form to schedule your service appointment.</p>
        </div>
        <div class="text-center">
          <div class="bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4 text-xl font-bold">
            2
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Diagnosis</h3>
          <p class="text-gray-600 text-sm">Our certified technician will assess your system and provide upfront pricing.</p>
        </div>
        <div class="text-center">
          <div class="bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4 text-xl font-bold">
            3
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Service</h3>
          <p class="text-gray-600 text-sm">We complete the work efficiently using quality parts and professional techniques.</p>
        </div>
        <div class="text-center">
          <div class="bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4 text-xl font-bold">
            4
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Follow-up</h3>
          <p class="text-gray-600 text-sm">We ensure your satisfaction and provide warranty coverage on all work.</p>
        </div>
      </div>
    </section>

    <!-- Customer Reviews for this Service -->
    <ReviewsSection 
      service={service.name} 
      limit={1} 
      variant="featured" 
      showCta={false} 
    />

    {service.emergency && (
      <section class="bg-red-600 text-white p-8 rounded-lg">
        <div class="text-center max-w-3xl mx-auto">
          <h2 class="text-3xl font-bold mb-4">Emergency {service.title} Available</h2>
          <p class="text-xl mb-6">
            Need urgent {service.name.toLowerCase()}? We're available 24/7 for emergencies!
          </p>
          <Button href="tel:(940) 390-5676" variant="secondary" size="xl" class="inline-flex justify-center min-w-[200px] max-w-[280px] mx-auto">
            Call Now: (940) 390-5676
          </Button>
        </div>
      </section>
    )}
  </div>
</BaseLayout>