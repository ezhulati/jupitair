---
import Button from '../ui/Button.astro';
import PremiumCard from '../ui/PremiumCard.astro';

export interface Props {
  formId?: string;
  variant?: 'default' | 'compact' | 'premium';
}

const { formId = 'contact-form', variant = 'premium' } = Astro.props;
---

<PremiumCard variant="glass" padding="lg" class="max-w-4xl mx-auto">
  <form 
    class="space-y-6" 
    name="contact" 
    method="POST" 
    data-netlify="true"
    netlify-honeypot="bot-field"
    id={formId}
  >
    <!-- Honeypot field for spam protection -->
    <input type="hidden" name="form-name" value="contact" />
    <div style="display: none;">
      <label>Don't fill this out if you're human: <input name="bot-field" /></label>
    </div>

    <!-- Form Header -->
    <div class="text-center space-y-2 mb-8">
      <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">
        Get Your Free Quote
      </h2>
      <p class="text-gray-600">
        Professional HVAC service starts here
      </p>
    </div>
    <!-- Name Fields -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="form-group">
        <label for="firstName" class="form-label">
          First Name <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            id="firstName"
            name="firstName"
            required
            placeholder="John"
            class="form-input pl-12"
          />
          <div class="input-icon left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="lastName" class="form-label">
          Last Name <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            id="lastName"
            name="lastName"
            required
            placeholder="Smith"
            class="form-input pl-12"
          />
          <div class="input-icon left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Contact Fields -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="form-group">
        <label for="email" class="form-label">
          Email Address <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="john@example.com"
            class="form-input pl-12"
          />
          <div class="input-icon left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="phone" class="form-label">
          Phone Number <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            placeholder="(214) 555-0123"
            class="form-input pl-12"
          />
          <div class="input-icon left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
          </div>
        </div>
      </div>
    </div>
  
  <!-- Address Fields -->
  <div>
    <label for="address" class="block text-sm font-semibold text-gray-900 mb-2">
      Service Address <span class="text-emergency-600">*</span>
    </label>
    <input
      type="text"
      id="address"
      name="address"
      required
      placeholder="123 Main St"
      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
    />
  </div>
  
  <div class="grid md:grid-cols-3 gap-6">
    <div class="md:col-span-2">
      <label for="city" class="block text-sm font-semibold text-gray-900 mb-2">
        City <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="city" 
        name="city" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select Your City</option>
        <option value="frisco">Frisco</option>
        <option value="plano">Plano</option>
        <option value="mckinney">McKinney</option>
        <option value="allen">Allen</option>
        <option value="prosper">Prosper</option>
        <option value="the-colony">The Colony</option>
        <option value="little-elm">Little Elm</option>
        <option value="addison">Addison</option>
        <option value="other">Other North Texas City</option>
      </select>
    </div>
    <div>
      <label for="zip" class="block text-sm font-semibold text-gray-900 mb-2">
        ZIP Code <span class="text-emergency-600">*</span>
      </label>
      <input
        type="text"
        id="zip"
        name="zip"
        required
        placeholder="75033"
        pattern="[0-9]{5}"
        maxlength="5"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Property Type and Service Selection -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="propertyType" class="block text-sm font-semibold text-gray-900 mb-2">
        Property Type <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="propertyType" 
        name="propertyType" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select property type</option>
        <option value="residential">Residential Home</option>
        <option value="commercial-restaurant">Commercial - Restaurant</option>
        <option value="commercial-retail">Commercial - Retail Store</option>
        <option value="commercial-office">Commercial - Office Building</option>
        <option value="commercial-warehouse">Commercial - Warehouse</option>
        <option value="commercial-other">Commercial - Other</option>
      </select>
    </div>
    <div>
      <label for="service" class="block text-sm font-semibold text-gray-900 mb-2">
        Service Needed <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="service" 
        name="service" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select a service</option>
        <option value="ac-repair">AC Repair</option>
        <option value="heating-repair">Heating Repair</option>
        <option value="hvac-installation">HVAC Installation</option>
        <option value="maintenance">Maintenance</option>
        <option value="emergency">Emergency Service</option>
        <option value="duct-cleaning">Duct Cleaning</option>
        <option value="thermostat">Thermostat Installation</option>
        <option value="air-quality">Indoor Air Quality</option>
        <option value="other">Other</option>
      </select>
    </div>
  </div>
  
      <!-- Preferred Date and Time -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="form-group">
        <label for="preferredDate" class="form-label">
          Preferred Date <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <input
            type="date"
            id="preferredDate"
            name="preferredDate"
            required
            min={new Date().toISOString().split('T')[0]}
            max={new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}
            class="form-input"
          />
        </div>
      </div>
      <div class="form-group">
        <label for="preferredTime" class="form-label">
          Preferred Time <span class="text-red-500">*</span>
        </label>
        <div class="input-wrapper">
          <select
            id="preferredTime"
            name="preferredTime"
            required
            class="form-input"
          >
            <option value="">Select preferred time</option>
            <option value="8:00 AM - 10:00 AM">8:00 AM - 10:00 AM</option>
            <option value="10:00 AM - 12:00 PM">10:00 AM - 12:00 PM</option>
            <option value="12:00 PM - 2:00 PM">12:00 PM - 2:00 PM</option>
            <option value="2:00 PM - 4:00 PM">2:00 PM - 4:00 PM</option>
            <option value="4:00 PM - 6:00 PM">4:00 PM - 6:00 PM</option>
            <option value="anytime">Any time that day</option>
          </select>
        </div>
      </div>
    </div>
  
    <!-- Message -->
    <div class="form-group">
      <label for="message" class="form-label">
        How Can We Help?
      </label>
      <div class="input-wrapper">
        <textarea
          id="message"
          name="message"
          rows="4"
          placeholder="Describe your HVAC issue or service needs..."
          class="form-input resize-none"
        ></textarea>
      </div>
    </div>
  
    <!-- Emergency Toggle -->
    <div class="emergency-toggle p-4 bg-red-50 rounded-xl border border-red-200 transition-all hover:border-red-300 hover:shadow-md">
      <label class="flex items-center justify-between cursor-pointer">
        <div class="flex items-center gap-3">
          <svg class="w-6 h-6 text-red-600 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
          <div>
            <p class="font-semibold text-red-900">Emergency Service Needed?</p>
            <p class="text-sm text-red-700">24/7 immediate response available</p>
          </div>
        </div>
        <div class="toggle-switch">
          <input type="checkbox" id="emergency" name="emergency" value="yes" class="sr-only" />
          <div class="toggle-slider"></div>
        </div>
      </label>
    </div>
  
  <!-- Submit Buttons -->
  <div class="flex flex-col gap-4">
    <Button type="submit" variant="primary" size="xl" class="w-full justify-center text-lg font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">
      Get My Free Estimate
    </Button>
    <Button href="tel:(940) 390-5676" variant="outline" size="xl" class="w-full justify-center text-lg font-semibold">
      <svg class="w-5 h-5 mr-2 inline-block" fill="currentColor" viewBox="0 0 20 20">
        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
      </svg>
      Call (940) 390-5676
    </Button>
  </div>
  </form>
</PremiumCard>

<style>
  /* Form Base Styles */
  .form-group {
    @apply space-y-2;
  }

  .form-label {
    @apply block text-sm font-semibold text-gray-700;
  }

  .input-wrapper {
    @apply relative;
  }

  .form-input {
    @apply w-full px-12 py-3.5 text-base
    bg-white/90 backdrop-blur-sm
    border-2 border-gray-200
    rounded-xl
    transition-all duration-200
    focus:border-blue-500
    focus:ring-4 focus:ring-blue-500/10
    hover:border-gray-300
    placeholder-gray-400;
  }

  .form-input:focus {
    @apply outline-none bg-white;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  /* Input Icons */
  .input-icon {
    @apply absolute top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none;
  }

  .input-icon.left {
    @apply left-4;
  }

  /* Toggle Switch */
  .toggle-switch {
    @apply relative inline-block w-14 h-7;
  }

  .toggle-slider {
    @apply absolute inset-0 bg-gray-300 rounded-full cursor-pointer transition-all duration-300;
  }

  .toggle-slider::before {
    content: '';
    @apply absolute left-1 top-1 w-5 h-5 bg-white rounded-full transition-all duration-300 shadow-sm;
  }

  input:checked + .toggle-slider {
    @apply bg-red-600;
  }

  input:checked + .toggle-slider::before {
    transform: translateX(28px);
  }

  /* Animations */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
    20%, 40%, 60%, 80% { transform: translateX(2px); }
  }

  .shake {
    animation: shake 0.5s ease-in-out;
  }

  /* Smooth transitions */
  select.form-input {
    @apply appearance-none bg-white/90;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 3rem;
  }

  /* Premium hover effects */
  .form-input:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .form-input:focus {
    transform: translateY(-1px);
    box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form[name="contact"]');
    
    forms.forEach(form => {
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Get form data
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          // Show loading state
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...';
          
          try {
            // Submit to Netlify Forms using fetch
            const response = await fetch('/', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: new URLSearchParams(formData).toString()
            });
            
            if (response.ok) {
              // Success - redirect to success page with emergency flag if needed
              const successUrl = data.emergency ? '/success?emergency=true' : '/success';
              window.location.href = successUrl;
            } else {
              throw new Error('Form submission failed');
            }
          } catch (error) {
            console.error('Form submission error:', error);
            alert('Unable to submit form. Please call us directly at (940) 390-5676');
          } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });
      }
    });
  });
</script>