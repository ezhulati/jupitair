---
import Button from '../ui/Button.astro';

export interface Props {
  formId?: string;
  variant?: 'default' | 'compact';
}

const { formId = 'contact-form', variant = 'default' } = Astro.props;
---

<form 
  class="space-y-6" 
  name="contact" 
  method="POST" 
  data-netlify="true"
  netlify-honeypot="bot-field"
  id={formId}
>
  <!-- Honeypot field for spam protection -->
  <input type="hidden" name="form-name" value="contact" />
  <div style="display: none;">
    <label>Don't fill this out if you're human: <input name="bot-field" /></label>
  </div>
  <!-- Name Fields -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="firstName" class="block text-sm font-semibold text-gray-900 mb-2">
        First Name <span class="text-emergency-600">*</span>
      </label>
      <input
        type="text"
        id="firstName"
        name="firstName"
        required
        placeholder="John"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
    <div>
      <label for="lastName" class="block text-sm font-semibold text-gray-900 mb-2">
        Last Name <span class="text-emergency-600">*</span>
      </label>
      <input
        type="text"
        id="lastName"
        name="lastName"
        required
        placeholder="Smith"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Contact Fields -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="email" class="block text-sm font-semibold text-gray-900 mb-2">
        Email Address <span class="text-emergency-600">*</span>
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        placeholder="john@example.com"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
    <div>
      <label for="phone" class="block text-sm font-semibold text-gray-900 mb-2">
        Phone Number <span class="text-emergency-600">*</span>
      </label>
      <input
        type="tel"
        id="phone"
        name="phone"
        required
        placeholder="(214) 555-0123"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Address Fields -->
  <div>
    <label for="address" class="block text-sm font-semibold text-gray-900 mb-2">
      Service Address <span class="text-emergency-600">*</span>
    </label>
    <input
      type="text"
      id="address"
      name="address"
      required
      placeholder="123 Main St"
      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
    />
  </div>
  
  <div class="grid md:grid-cols-3 gap-6">
    <div class="md:col-span-2">
      <label for="city" class="block text-sm font-semibold text-gray-900 mb-2">
        City <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="city" 
        name="city" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select Your City</option>
        <option value="frisco">Frisco</option>
        <option value="plano">Plano</option>
        <option value="mckinney">McKinney</option>
        <option value="allen">Allen</option>
        <option value="prosper">Prosper</option>
        <option value="the-colony">The Colony</option>
        <option value="little-elm">Little Elm</option>
        <option value="addison">Addison</option>
        <option value="other">Other North Texas City</option>
      </select>
    </div>
    <div>
      <label for="zip" class="block text-sm font-semibold text-gray-900 mb-2">
        ZIP Code <span class="text-emergency-600">*</span>
      </label>
      <input
        type="text"
        id="zip"
        name="zip"
        required
        placeholder="75033"
        pattern="[0-9]{5}"
        maxlength="5"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Property Type and Service Selection -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="propertyType" class="block text-sm font-semibold text-gray-900 mb-2">
        Property Type <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="propertyType" 
        name="propertyType" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select property type</option>
        <option value="residential">Residential Home</option>
        <option value="commercial-restaurant">Commercial - Restaurant</option>
        <option value="commercial-retail">Commercial - Retail Store</option>
        <option value="commercial-office">Commercial - Office Building</option>
        <option value="commercial-warehouse">Commercial - Warehouse</option>
        <option value="commercial-other">Commercial - Other</option>
      </select>
    </div>
    <div>
      <label for="service" class="block text-sm font-semibold text-gray-900 mb-2">
        Service Needed <span class="text-emergency-600">*</span>
      </label>
      <select 
        id="service" 
        name="service" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select a service</option>
        <option value="ac-repair">AC Repair</option>
        <option value="heating-repair">Heating Repair</option>
        <option value="hvac-installation">HVAC Installation</option>
        <option value="maintenance">Maintenance</option>
        <option value="emergency">Emergency Service</option>
        <option value="duct-cleaning">Duct Cleaning</option>
        <option value="thermostat">Thermostat Installation</option>
        <option value="air-quality">Indoor Air Quality</option>
        <option value="other">Other</option>
      </select>
    </div>
  </div>
  
  <!-- Preferred Date and Time -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="preferredDate" class="block text-sm font-semibold text-gray-900 mb-2">
        Preferred Date <span class="text-emergency-600">*</span>
      </label>
      <input
        type="date"
        id="preferredDate"
        name="preferredDate"
        required
        min={new Date().toISOString().split('T')[0]}
        max={new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
    <div>
      <label for="preferredTime" class="block text-sm font-semibold text-gray-900 mb-2">
        Preferred Time <span class="text-emergency-600">*</span>
      </label>
      <select
        id="preferredTime"
        name="preferredTime"
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select preferred time</option>
        <option value="8:00 AM - 10:00 AM">8:00 AM - 10:00 AM</option>
        <option value="10:00 AM - 12:00 PM">10:00 AM - 12:00 PM</option>
        <option value="12:00 PM - 2:00 PM">12:00 PM - 2:00 PM</option>
        <option value="2:00 PM - 4:00 PM">2:00 PM - 4:00 PM</option>
        <option value="4:00 PM - 6:00 PM">4:00 PM - 6:00 PM</option>
        <option value="anytime">Any time that day</option>
      </select>
    </div>
  </div>
  
  <!-- Message -->
  <div>
    <label for="message" class="block text-sm font-semibold text-gray-900 mb-2">
      How Can We Help?
    </label>
    <textarea
      id="message"
      name="message"
      rows="4"
      placeholder="Describe your HVAC issue or service needs..."
      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all resize-none"
    ></textarea>
  </div>
  
  <!-- Emergency Toggle -->
  <div class="bg-emergency-50 border-2 border-emergency-200 rounded-xl p-4">
    <label class="flex items-start cursor-pointer">
      <input
        type="checkbox"
        id="emergency"
        name="emergency"
        class="mt-1 h-5 w-5 text-emergency-600 border-2 border-emergency-300 rounded focus:ring-emergency-500"
      />
      <div class="ml-3">
        <span class="font-bold text-emergency-700">This is an EMERGENCY</span>
        <p class="text-sm text-emergency-600 mt-1">
          Check if your AC/heating is not working, water leak, or system failure
        </p>
      </div>
    </label>
  </div>
  
  <!-- Submit Buttons -->
  <div class="flex flex-col gap-4">
    <Button type="submit" variant="primary" size="xl" class="w-full justify-center text-lg font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">
      Get My Free Estimate
    </Button>
    <Button href="tel:(940) 390-5676" variant="outline" size="xl" class="w-full justify-center text-lg font-semibold">
      <svg class="w-5 h-5 mr-2 inline-block" fill="currentColor" viewBox="0 0 20 20">
        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
      </svg>
      Call (940) 390-5676
    </Button>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form[name="contact"]');
    
    forms.forEach(form => {
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Get form data
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          // Check if emergency
          if (data.emergency) {
            if (confirm('This is an emergency! Would you like to call us directly for immediate assistance?')) {
              window.location.href = 'tel:(940) 390-5676';
              return;
            }
          }
          
          // Show loading state
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...';
          
          try {
            // Submit to Netlify Forms using fetch
            const response = await fetch('/', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: new URLSearchParams(formData).toString()
            });
            
            if (response.ok) {
              // Success - redirect to success page
              window.location.href = '/success';
            } else {
              throw new Error('Form submission failed');
            }
          } catch (error) {
            console.error('Form submission error:', error);
            alert('Unable to submit form. Please call us directly at (940) 390-5676');
          } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });
      }
    });
  });
</script>