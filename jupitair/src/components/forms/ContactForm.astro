---
import Button from '../ui/Button.astro';

export interface Props {
  formId?: string;
  variant?: 'default' | 'compact';
}

const { formId = 'contact-form', variant = 'default' } = Astro.props;
---

<form class="space-y-6" action="/api/contact" method="POST" id={formId}>
  <!-- Name Fields -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="firstName" class="block text-sm font-semibold text-gray-900 mb-2">
        First Name
      </label>
      <input
        type="text"
        id="firstName"
        name="firstName"
        required
        placeholder="John"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
    <div>
      <label for="lastName" class="block text-sm font-semibold text-gray-900 mb-2">
        Last Name
      </label>
      <input
        type="text"
        id="lastName"
        name="lastName"
        required
        placeholder="Smith"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Contact Fields -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="phone" class="block text-sm font-semibold text-gray-900 mb-2">
        Phone Number
      </label>
      <input
        type="tel"
        id="phone"
        name="phone"
        required
        placeholder="(940) 555-0123"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
    <div>
      <label for="email" class="block text-sm font-semibold text-gray-900 mb-2">
        Email Address
      </label>
      <input
        type="email"
        id="email"
        name="email"
        placeholder="john@example.com"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all"
      />
    </div>
  </div>
  
  <!-- Service Selection -->
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <label for="city" class="block text-sm font-semibold text-gray-900 mb-2">
        Your City
      </label>
      <select 
        id="city" 
        name="city" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select Your City</option>
        <option value="frisco">Frisco</option>
        <option value="plano">Plano</option>
        <option value="mckinney">McKinney</option>
        <option value="allen">Allen</option>
        <option value="prosper">Prosper</option>
        <option value="the-colony">The Colony</option>
        <option value="little-elm">Little Elm</option>
        <option value="addison">Addison</option>
        <option value="other">Other North Texas City</option>
      </select>
    </div>
    <div>
      <label for="service" class="block text-sm font-semibold text-gray-900 mb-2">
        Service Needed
      </label>
      <select 
        id="service" 
        name="service" 
        required
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all appearance-none bg-white"
      >
        <option value="">Select Service</option>
        <option value="ac-repair">AC Repair</option>
        <option value="heating-repair">Heating Repair</option>
        <option value="hvac-installation">New Installation</option>
        <option value="maintenance">Maintenance</option>
        <option value="duct-cleaning">Duct Cleaning</option>
        <option value="thermostat">Smart Thermostat</option>
        <option value="emergency">Emergency Service</option>
        <option value="other">Other / Not Sure</option>
      </select>
    </div>
  </div>
  
  <!-- Message -->
  <div>
    <label for="message" class="block text-sm font-semibold text-gray-900 mb-2">
      How Can We Help?
    </label>
    <textarea
      id="message"
      name="message"
      rows="4"
      placeholder="Describe your HVAC issue or service needs..."
      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all resize-none"
    ></textarea>
  </div>
  
  <!-- Emergency Toggle -->
  <div class="bg-emergency-50 border-2 border-emergency-200 rounded-xl p-4">
    <label class="flex items-start cursor-pointer">
      <input
        type="checkbox"
        id="emergency"
        name="emergency"
        class="mt-1 h-5 w-5 text-emergency-600 border-2 border-emergency-300 rounded focus:ring-emergency-500"
      />
      <div class="ml-3">
        <span class="font-bold text-emergency-700">This is an EMERGENCY</span>
        <p class="text-sm text-emergency-600 mt-1">
          Check if your AC/heating is not working, water leak, or system failure
        </p>
      </div>
    </label>
  </div>
  
  <!-- Submit Button -->
  <div class="flex flex-col sm:flex-row gap-4">
    <Button type="submit" variant="primary" size="xl" class="flex-1 justify-center text-lg font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">
      Get My Free Estimate
    </Button>
    <Button href="tel:(940) 390-5676" variant="outline" size="xl" class="flex-1 justify-center text-lg font-semibold">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
      </svg>
      Call (940) 390-5676
    </Button>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll(`form[id^="contact-form"]`);
    
    forms.forEach(form => {
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Get form data
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          // Check if emergency
          if (data.emergency) {
            if (confirm('This is an emergency! Would you like to call us directly for immediate assistance?')) {
              window.location.href = 'tel:(940) 390-5676';
              return;
            }
          }
          
          // Show loading state
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...';
          
          try {
            // Submit to API
            const response = await fetch('/api/contact', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (response.ok && result.success) {
              // Success - redirect to success page
              window.location.href = '/success';
            } else {
              // Error from API
              throw new Error(result.error || 'Submission failed');
            }
          } catch (error) {
            console.error('Form submission error:', error);
            alert('Unable to submit form. Please call us directly at (940) 390-5676');
          } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });
      }
    });
  });
</script>