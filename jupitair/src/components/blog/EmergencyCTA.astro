---
/**
 * Emergency CTA Banner Component for Jupitair HVAC Blog
 * Features: Urgent styling, prominent placement, accessibility
 */

interface Props {
  message?: string;
  phone?: string;
  className?: string;
  isSticky?: boolean;
}

const { 
  message = "HVAC Emergency? We're here 24/7 to help!",
  phone = "(940) 390-5676",
  className = "",
  isSticky = true
} = Astro.props;
---

<div 
  class={`emergency-cta ${isSticky ? 'fixed top-0 left-0 right-0' : ''} z-[60] bg-gradient-to-r from-red-600 to-red-700 text-white shadow-lg ${className}`}
  role="banner"
  aria-label="Emergency service notice"
>
  <div class="container mx-auto px-4 py-2 md:py-3">
    <div class="flex flex-col sm:flex-row items-center justify-between gap-2 md:gap-3">
      <!-- Emergency Icon & Message -->
      <div class="flex items-center gap-2 md:gap-3 text-center sm:text-left">
        <!-- Pulsing emergency icon -->
        <div class="relative hidden sm:block">
          <div class="absolute inset-0 bg-white rounded-full animate-ping opacity-25"></div>
          <div class="relative bg-white/20 rounded-full p-1.5 md:p-2">
            <svg class="w-4 h-4 md:w-6 md:h-6 text-white" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
          </div>
        </div>
        
        <div>
          <p class="font-semibold text-xs sm:text-sm md:text-base">
            {message}
          </p>
          <p class="text-red-100 text-xs hidden sm:block">
            Fast response • Licensed technicians • Available now
          </p>
        </div>
      </div>

      <!-- Call to Action Buttons -->
      <div class="flex flex-row gap-2 w-full sm:w-auto">
        <!-- Primary CTA: Call Now -->
        <a 
          href={`tel:${phone.replace(/[^\d]/g, '')}`}
          class="group flex items-center justify-center gap-1 md:gap-2 bg-white text-red-600 hover:bg-red-50 px-3 md:px-4 py-1.5 md:py-2 rounded-lg font-bold text-xs md:text-sm transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 flex-1 sm:flex-none sm:min-w-[140px]"
          aria-label={`Call emergency service at ${phone}`}
        >
          <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          <span class="hidden sm:inline">Call </span><span>{phone}</span>
        </a>

        <!-- Secondary CTA: Schedule Online -->
        <a 
          href="/contact"
          class="flex items-center justify-center gap-1 md:gap-2 border-2 border-white text-white hover:bg-white hover:text-red-600 px-3 md:px-4 py-1.5 md:py-2 rounded-lg font-semibold text-xs md:text-sm transition-all duration-200 flex-1 sm:flex-none sm:min-w-[120px]"
          aria-label="Schedule emergency service online"
        >
          <svg class="w-3 h-3 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0h6m-6 0v6a2 2 0 002 2h2a2 2 0 002-2V7"/>
          </svg>
          <span>Schedule</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Subtle bottom border for visual separation -->
  <div class="border-b border-red-500"></div>
</div>

<!-- Dismissible functionality (optional) -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Set CSS variable for header offset when emergency bar is present
    const emergencyCTA = document.querySelector('.emergency-cta');
    if (emergencyCTA) {
      const emergencyBarHeight = emergencyCTA.offsetHeight;
      document.documentElement.style.setProperty('--emergency-bar-offset', `${emergencyBarHeight}px`);
      // Hide the mobile emergency banner in header since we have our own
      document.documentElement.style.setProperty('--mobile-emergency-display', 'none');
    }
    
    // Track emergency CTA interactions
    const callButton = emergencyCTA?.querySelector('a[href^="tel:"]');
    const scheduleButton = emergencyCTA?.querySelector('a[href="/contact"]');

    if (callButton) {
      callButton.addEventListener('click', function() {
        // Analytics tracking
        if (typeof gtag !== 'undefined') {
          gtag('event', 'emergency_call', {
            event_category: 'emergency',
            event_label: 'header_banner',
            transport_type: 'beacon'
          });
        }
      });
    }

    if (scheduleButton) {
      scheduleButton.addEventListener('click', function() {
        // Analytics tracking
        if (typeof gtag !== 'undefined') {
          gtag('event', 'emergency_schedule', {
            event_category: 'emergency',
            event_label: 'header_banner',
            transport_type: 'beacon'
          });
        }
      });
    }
  });
</script>

<style>
  .emergency-cta {
    /* Ensure it stays above other content */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  /* Enhanced emergency styling */
  @keyframes emergency-pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
    }
  }
  
  .emergency-cta {
    animation: emergency-pulse 3s ease-in-out infinite;
  }
  
  /* Focus management for accessibility */
  .emergency-cta a:focus {
    outline: 3px solid #FEF2F2;
    outline-offset: 2px;
  }
  
  /* Mobile optimizations */
  @media (max-width: 640px) {
    .emergency-cta {
      position: fixed; /* Keep fixed but make smaller */
      top: 0;
      left: 0;
      right: 0;
    }
  }
  
  /* Print styles - hide emergency banner when printing */
  @media print {
    .emergency-cta {
      display: none;
    }
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .emergency-cta {
      border: 3px solid white;
    }
    
    .emergency-cta a {
      border-width: 3px;
      font-weight: bold;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .emergency-cta {
      animation: none;
    }
    
    .emergency-cta .animate-ping {
      animation: none;
    }
    
    .emergency-cta a {
      transition: none;
      transform: none;
    }
    
    .emergency-cta a:hover {
      transform: none;
    }
  }
</style>