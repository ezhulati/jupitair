---
import BaseLayout from '../layouts/BaseLayout.astro';
import PremiumCard from '../components/ui/PremiumCard.astro';
import { readFileSync } from 'fs';
import { parse } from 'yaml';

// Load data
const servicesData = parse(readFileSync('./data/services.yml', 'utf8'));
const citiesData = parse(readFileSync('./data/cities.yml', 'utf8'));

const services = servicesData?.money_pages || [];
const cities = citiesData?.cities || [];

// Group services by category
const servicesByCategory = services.reduce((acc: any, service: any) => {
  const category = service.category || 'other';
  if (!acc[category]) acc[category] = [];
  acc[category].push(service);
  return acc;
}, {});

const categoryNames: Record<string, string> = {
  cooling: 'Air Conditioning Services',
  heating: 'Heating Services',
  installation: 'HVAC Installation',
  maintenance: 'Maintenance & Tune-Ups',
  efficiency: 'Energy Efficiency',
  emergency: 'Emergency Services',
  other: 'Other Services'
};

const pageTitle = "Sitemap | All Pages | Jupitair HVAC";
const pageDescription = "Complete sitemap of Jupitair HVAC website. Find all our HVAC services, city pages, and resources for North Texas residents.";
---

<BaseLayout 
  title={pageTitle}
  description={pageDescription}
  canonical="https://jupitairhvac.com/sitemap"
>
  <div class="min-h-screen bg-gradient-to-br from-white via-gray-50 to-blue-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-12">
      <div class="container mx-auto px-4">
        <h1 class="text-4xl font-bold mb-4">Sitemap</h1>
        <p class="text-xl text-blue-100">Complete directory of all pages on Jupitair HVAC</p>
      </div>
    </div>

    <div class="container mx-auto px-4 py-12">
      <div class="grid lg:grid-cols-3 gap-8">
        
        <!-- Main Pages -->
        <PremiumCard variant="glass" padding="lg">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b border-gray-200 pb-3">Main Pages</h2>
          <ul class="space-y-3">
            <li>
              <a href="/" class="text-blue-600 hover:text-blue-800 hover:underline font-medium">
                Homepage
              </a>
            </li>
            <li>
              <a href="/about" class="text-blue-600 hover:text-blue-800 hover:underline">
                About Us
              </a>
            </li>
            <li>
              <a href="/services" class="text-blue-600 hover:text-blue-800 hover:underline">
                All Services
              </a>
            </li>
            <li>
              <a href="/contact" class="text-blue-600 hover:text-blue-800 hover:underline">
                Contact Us
              </a>
            </li>
            <li>
              <a href="/schedule" class="text-blue-600 hover:text-blue-800 hover:underline">
                Schedule Service
              </a>
            </li>
            <li>
              <a href="/privacy" class="text-blue-600 hover:text-blue-800 hover:underline text-sm">
                Privacy Policy
              </a>
            </li>
            <li>
              <a href="/terms" class="text-blue-600 hover:text-blue-800 hover:underline text-sm">
                Terms of Service
              </a>
            </li>
          </ul>
        </PremiumCard>

        <!-- Service Pages -->
        <PremiumCard variant="glass" padding="lg" class="lg:col-span-2">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b border-gray-200 pb-3">Service Pages</h2>
          <div class="grid md:grid-cols-2 gap-6">
            {Object.entries(servicesByCategory).map(([category, categoryServices]) => (
              <div>
                <h3 class="font-semibold text-gray-700 mb-3 text-sm uppercase tracking-wide">
                  {categoryNames[category]}
                </h3>
                <ul class="space-y-2">
                  {(categoryServices as any[]).map((service) => (
                    <li>
                      <a 
                        href={`/services/${service.slug}`}
                        class="text-blue-600 hover:text-blue-800 hover:underline text-sm"
                      >
                        {service.name}
                        {service.emergency && (
                          <span class="ml-2 text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full">
                            24/7
                          </span>
                        )}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </PremiumCard>

        <!-- City Pages -->
        <PremiumCard variant="glass" padding="lg">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b border-gray-200 pb-3">Service Areas</h2>
          <ul class="space-y-3">
            {cities.map((city: any) => (
              <li>
                <a 
                  href={`/${city.slug}`}
                  class="text-blue-600 hover:text-blue-800 hover:underline"
                >
                  {city.name}, TX
                </a>
                <span class="text-gray-500 text-sm ml-2">
                  Pop. {city.population.toLocaleString()}
                </span>
              </li>
            ))}
          </ul>
        </PremiumCard>

        <!-- City + Service Combinations -->
        <PremiumCard variant="glass" padding="lg" class="lg:col-span-2">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b border-gray-200 pb-3">Services by City</h2>
          <div class="text-sm text-gray-600 mb-4">
            We offer all our services in every city we serve. Here are quick links to our most popular service + city combinations:
          </div>
          <div class="grid md:grid-cols-2 gap-6">
            {cities.slice(0, 4).map((city: any) => (
              <div>
                <h3 class="font-semibold text-gray-700 mb-3">
                  {city.name}
                </h3>
                <ul class="space-y-1">
                  {services.slice(0, 6).map((service: any) => (
                    <li>
                      <a 
                        href={`/${city.slug}/${service.slug}`}
                        class="text-blue-600 hover:text-blue-800 hover:underline text-sm"
                      >
                        {service.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </PremiumCard>

      </div>

      <!-- SEO Footer -->
      <div class="mt-12 text-center">
        <PremiumCard variant="glass" padding="md">
          <p class="text-gray-600 mb-4">
            This sitemap helps both users and search engines navigate our website efficiently.
          </p>
          <div class="flex flex-wrap justify-center gap-4 text-sm">
            <a href="/sitemap.xml" class="text-blue-600 hover:text-blue-800 hover:underline">
              XML Sitemap (for search engines)
            </a>
            <span class="text-gray-400">•</span>
            <a href="/robots.txt" class="text-blue-600 hover:text-blue-800 hover:underline">
              Robots.txt
            </a>
            <span class="text-gray-400">•</span>
            <span class="text-gray-600">
              Last Updated: {new Date().toLocaleDateString()}
            </span>
          </div>
        </PremiumCard>
      </div>
    </div>
  </div>
</BaseLayout>