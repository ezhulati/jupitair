---
import BaseLayout from '../layouts/BaseLayout.astro';
import PremiumHero from '../components/layout/PremiumHero.astro';
import Button from '../components/ui/Button.astro';
import Card from '../components/ui/Card.astro';
import PremiumCard from '../components/ui/PremiumCard.astro';
import Input from '../components/ui/Input.astro';

const pageTitle = 'Contact Us | Jupitair HVAC - Get Your Free Estimate';
const pageDescription = 'Contact Jupitair HVAC for all your heating and cooling needs in North Texas. Available 24/7 for emergency service. Call (940) 390-5676 or fill out our form for a free estimate.';

// Business schema for contact page
const contactSchema = {
  "@type": ["LocalBusiness", "HVACBusiness"],
  "name": "Jupitair HVAC",
  "description": pageDescription,
  "telephone": "(940) 390-5676",
  "email": "contact@jupitairhvac.com",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "5760 Legacy Dr B3-501",
    "addressLocality": "Plano",
    "addressRegion": "TX",
    "postalCode": "75024",
    "addressCountry": "US"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 33.1507,
    "longitude": -96.8236
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "opens": "08:00",
      "closes": "18:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "08:00",
      "closes": "16:00"
    }
  ],
  "areaServed": [
    "Frisco", "Plano", "McKinney", "Allen", 
    "Prosper", "The Colony", "Little Elm", "Addison"
  ]
};
---

<BaseLayout 
  title={pageTitle} 
  description={pageDescription}
  canonical="https://jupitairhvac.com/contact"
  keywords="contact HVAC North Texas, HVAC estimate Frisco, emergency AC repair, heating service Plano"
  schema={contactSchema}
>
  <!-- Premium Hero Section -->
  <PremiumHero 
    title="Get Your Free HVAC Estimate"
    subtitle="Professional Service You Can Trust"
    description="Contact Jupitair HVAC for reliable heating and cooling services throughout North Texas. Available 24/7 for emergency service."
    ctaPrimary={{ text: "Call (940) 390-5676", href: "tel:9403905676" }}
    ctaSecondary={{ text: "Schedule Service", href: "/schedule" }}
    variant="gradient"
    height="sm"
  />
  
  <div class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl py-12 sm:py-16 lg:py-20">

      <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 mb-12">
      
        <!-- Contact Form -->
        <div>
          <Card variant="elevated" padding="lg" class="h-full">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Request Service</h2>
          
          <form id="contact-form" class="space-y-5">
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label for="first-name" class="block text-sm font-medium text-gray-700 mb-2">
                  First Name <span class="text-emergency-600">*</span>
                </label>
                <Input 
                  type="text" 
                  id="first-name" 
                  name="first-name" 
                  required 
                  placeholder="John"
                />
              </div>
              
              <div>
                <label for="last-name" class="block text-sm font-medium text-gray-700 mb-2">
                  Last Name <span class="text-emergency-600">*</span>
                </label>
                <Input 
                  type="text" 
                  id="last-name" 
                  name="last-name" 
                  required 
                  placeholder="Doe"
                />
              </div>
            </div>
            
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                Email Address <span class="text-emergency-600">*</span>
              </label>
              <Input 
                type="email" 
                id="email" 
                name="email" 
                required 
                placeholder="john@example.com"
              />
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                Phone Number <span class="text-emergency-600">*</span>
              </label>
              <Input 
                type="tel" 
                id="phone" 
                name="phone" 
                required 
                placeholder="(214) 555-0123"
              />
            </div>
            
            <div>
              <label for="address" class="block text-sm font-medium text-gray-700 mb-2">
                Service Address <span class="text-emergency-600">*</span>
              </label>
              <Input 
                type="text" 
                id="address" 
                name="address" 
                required 
                placeholder="123 Main St"
              />
            </div>
            
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                  City <span class="text-emergency-600">*</span>
                </label>
                <Input 
                  type="text" 
                  id="city" 
                  name="city" 
                  required 
                  placeholder="Frisco"
                />
              </div>
              
              <div>
                <label for="zip" class="block text-sm font-medium text-gray-700 mb-2">
                  ZIP Code <span class="text-emergency-600">*</span>
                </label>
                <Input 
                  type="text" 
                  id="zip" 
                  name="zip" 
                  required 
                  placeholder="75033"
                  pattern="[0-9]{5}"
                  maxlength="5"
                />
              </div>
            </div>
            
            <div>
              <label for="property-type" class="block text-sm font-medium text-gray-700 mb-2">
                Property Type <span class="text-emergency-600">*</span>
              </label>
              <select 
                id="property-type" 
                name="property-type" 
                required
                class="block w-full border border-gray-300 rounded-lg shadow-sm px-5 py-3 text-base min-h-[44px] sm:min-h-[48px] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              >
                <option value="">Select property type</option>
                <option value="residential">Residential Home</option>
                <option value="commercial-restaurant">Commercial - Restaurant</option>
                <option value="commercial-retail">Commercial - Retail Store</option>
                <option value="commercial-office">Commercial - Office Building</option>
                <option value="commercial-warehouse">Commercial - Warehouse</option>
                <option value="commercial-other">Commercial - Other</option>
              </select>
            </div>
            
            <div>
              <label for="service" class="block text-sm font-medium text-gray-700 mb-2">
                Service Needed <span class="text-emergency-600">*</span>
              </label>
              <select 
                id="service" 
                name="service" 
                required
                class="block w-full border border-gray-300 rounded-lg shadow-sm px-5 py-3 text-base min-h-[44px] sm:min-h-[48px] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              >
                <option value="">Select a service</option>
                <option value="ac-repair">AC Repair</option>
                <option value="heating-repair">Heating Repair</option>
                <option value="hvac-installation">HVAC Installation</option>
                <option value="maintenance">Maintenance</option>
                <option value="emergency">Emergency Service</option>
                <option value="duct-cleaning">Duct Cleaning</option>
                <option value="thermostat">Thermostat Installation</option>
                <option value="air-quality">Indoor Air Quality</option>
                <option value="other">Other</option>
              </select>
            </div>
            
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label for="preferred-date" class="block text-sm font-medium text-gray-700 mb-2">
                  Preferred Date <span class="text-emergency-600">*</span>
                </label>
                <Input 
                  type="date" 
                  id="preferred-date" 
                  name="preferred-date" 
                  required
                  min={new Date().toISOString().split('T')[0]}
                  max={new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}
                />
              </div>
              
              <div>
                <label for="preferred-time" class="block text-sm font-medium text-gray-700 mb-2">
                  Preferred Time <span class="text-emergency-600">*</span>
                </label>
                <select 
                  id="preferred-time" 
                  name="preferred-time" 
                  required
                  class="block w-full border border-gray-300 rounded-lg shadow-sm px-5 py-3 text-base min-h-[44px] sm:min-h-[48px] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  disabled
                >
                  <option value="">First select a date to see available times</option>
                </select>
                <div id="time-loading" class="hidden mt-2 text-sm text-gray-600 flex items-center">
                  <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Checking availability...
                </div>
                <div id="availability-message" class="hidden mt-2 text-sm"></div>
              </div>
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                Message
              </label>
              <textarea 
                id="message" 
                name="message" 
                rows="4"
                placeholder="Tell us more about your HVAC needs..."
                class="block w-full border border-gray-300 rounded-lg shadow-sm px-5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              ></textarea>
            </div>
            
            <div>
              <label class="flex items-start">
                <input 
                  type="checkbox" 
                  name="emergency" 
                  class="mt-1 mr-3 h-4 w-4 text-emergency-600 border-gray-300 rounded focus:ring-emergency-500"
                />
                <span class="text-sm text-gray-600">
                  This is an emergency - I need service ASAP
                </span>
              </label>
            </div>
            
            <Button type="submit" variant="primary" size="lg" class="w-full justify-center">
              Submit Request
            </Button>
            
            <p class="text-xs text-gray-500 text-center mt-4">
              By submitting this form, you agree to be contacted by Jupitair HVAC regarding your service request.
            </p>
          </form>
          </Card>
        </div>
      
        <!-- Contact Information -->
        <div class="space-y-6 lg:sticky lg:top-24">
        
          <!-- Emergency CTA -->
          <Card variant="elevated" class="bg-gradient-to-br from-emergency-50 to-emergency-100 border-2 border-emergency-200">
          <div class="text-center py-2">
            <h3 class="text-xl font-bold text-emergency-700 mb-2">
              Need Emergency Service?
            </h3>
            <p class="text-emergency-600 mb-4">
              Available 24/7 for urgent HVAC repairs
            </p>
            <Button href="tel:(940) 390-5676" variant="emergency" size="lg" class="w-full justify-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
              </svg>
              Call Now: (940) 390-5676
            </Button>
          </div>
        </Card>
        
        <!-- Business Hours -->
        <Card variant="default" padding="md">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Business Hours</h3>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-gray-600">Monday - Friday</span>
              <span class="font-medium text-gray-900">8:00 AM - 6:00 PM</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Saturday</span>
              <span class="font-medium text-gray-900">8:00 AM - 4:00 PM</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Sunday</span>
              <span class="font-medium text-gray-900">Emergency Only</span>
            </div>
            <hr class="my-3">
            <div class="flex justify-between">
              <span class="text-emergency-600 font-medium">24/7 Emergency</span>
              <span class="font-bold text-emergency-600">Always Available</span>
            </div>
          </div>
        </Card>
        
        <!-- Contact Methods -->
        <Card variant="default" padding="md">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Contact Information</h3>
          <div class="space-y-4">
            <a href="tel:(940) 390-5676" class="flex items-start space-x-3 text-gray-600 hover:text-primary-600 transition-colors">
              <svg class="w-6 h-6 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
              </svg>
              <div>
                <div class="font-medium text-gray-900">(940) 390-5676</div>
                <div class="text-sm">Main Office Line</div>
              </div>
            </a>
            
            <a href="mailto:contact@jupitairhvac.com" class="flex items-start space-x-3 text-gray-600 hover:text-primary-600 transition-colors">
              <svg class="w-6 h-6 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
              </svg>
              <div>
                <div class="font-medium text-gray-900">contact@jupitairhvac.com</div>
                <div class="text-sm">Email Support</div>
              </div>
            </a>
            
            <div class="flex items-start space-x-3 text-gray-600">
              <svg class="w-6 h-6 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
              </svg>
              <div>
                <div class="font-medium text-gray-900">Main Office</div>
                <div class="text-sm">
                  5760 Legacy Dr B3-501<br>
                  Plano, TX 75024
                </div>
              </div>
            </div>
          </div>
        </Card>
        
          <!-- Service Areas -->
          <Card variant="default" padding="md">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Service Areas</h3>
            <div class="grid grid-cols-2 gap-3">
              <a href="/frisco" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Frisco</a>
              <a href="/plano" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Plano</a>
              <a href="/mckinney" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">McKinney</a>
              <a href="/allen" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Allen</a>
              <a href="/prosper" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Prosper</a>
              <a href="/the-colony" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">The Colony</a>
              <a href="/little-elm" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Little Elm</a>
              <a href="/addison" class="text-primary-600 hover:text-primary-800 hover:underline font-medium">Addison</a>
            </div>
          </Card>
        
      </div>
    </div>
    
      <!-- Trust Indicators -->
      <section class="bg-white py-12 sm:py-16 rounded-2xl shadow-sm border border-gray-100">
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mb-3">
            <svg class="w-8 h-8 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
          </div>
            <h4 class="font-bold text-gray-900">Licensed & Insured</h4>
            <p class="text-sm text-gray-600 mt-1">Fully certified technicians</p>
        </div>
        
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-success-100 rounded-full flex items-center justify-center mb-3">
            <svg class="w-8 h-8 text-success-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          </div>
            <h4 class="font-bold text-gray-900">4.9/5 Rating</h4>
            <p class="text-sm text-gray-600 mt-1">500+ happy customers</p>
        </div>
        
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mb-3">
            <svg class="w-8 h-8 text-secondary-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
          </div>
            <h4 class="font-bold text-gray-900">15+ Years</h4>
            <p class="text-sm text-gray-600 mt-1">Serving North Texas</p>
        </div>
        
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-emergency-100 rounded-full flex items-center justify-center mb-3">
            <svg class="w-8 h-8 text-emergency-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
            </svg>
          </div>
            <h4 class="font-bold text-gray-900">24/7 Service</h4>
            <p class="text-sm text-gray-600 mt-1">Emergency repairs</p>
        </div>
        </div>
      </section>
    </div>
  </div>
  
  <script>
    // Real-time availability checking
    async function checkAvailability(date, serviceType) {
      const timeSelect = document.getElementById('preferred-time');
      const loadingDiv = document.getElementById('time-loading');
      const messageDiv = document.getElementById('availability-message');
      
      if (!timeSelect || !loadingDiv || !messageDiv) return;
      
      // Show loading state
      loadingDiv.classList.remove('hidden');
      messageDiv.classList.add('hidden');
      timeSelect.disabled = true;
      timeSelect.innerHTML = '<option value="">Loading available times...</option>';
      
      try {
        const params = new URLSearchParams({ 
          date: date,
          service: serviceType || 'general'
        });
        
        const response = await fetch(`/api/availability?${params}`);
        const data = await response.json();
        
        // Hide loading
        loadingDiv.classList.add('hidden');
        
        if (data.availableSlots && data.availableSlots.length > 0) {
          // Populate available time slots
          timeSelect.innerHTML = '<option value="">Select preferred time</option>';
          data.availableSlots.forEach(slot => {
            const option = document.createElement('option');
            option.value = slot.value;
            option.textContent = slot.label;
            timeSelect.appendChild(option);
          });
          
          // Add "any available time" option
          const anyOption = document.createElement('option');
          anyOption.value = 'anytime';
          anyOption.textContent = 'Any available time that day';
          timeSelect.appendChild(anyOption);
          
          timeSelect.disabled = false;
          
          // Show success message
          if (data.message) {
            messageDiv.textContent = data.message;
            messageDiv.className = 'mt-2 text-sm text-green-600';
            messageDiv.classList.remove('hidden');
          } else if (data.businessHours) {
            messageDiv.textContent = `Business hours: ${data.businessHours}`;
            messageDiv.className = 'mt-2 text-sm text-gray-600';
            messageDiv.classList.remove('hidden');
          }
          
        } else {
          // No available slots
          timeSelect.innerHTML = '<option value="">No available times</option>';
          timeSelect.disabled = true;
          
          const message = data.message || 'No available time slots for this date.';
          messageDiv.textContent = message;
          messageDiv.className = 'mt-2 text-sm text-yellow-600';
          messageDiv.classList.remove('hidden');
          
          // If it's Sunday or has a call message, style differently
          if (message.includes('call')) {
            messageDiv.className = 'mt-2 text-sm text-emergency-600 font-medium';
          }
        }
        
      } catch (error) {
        console.error('Error checking availability:', error);
        loadingDiv.classList.add('hidden');
        
        // Fallback to default time slots
        timeSelect.innerHTML = `
          <option value="">Select preferred time</option>
          <option value="8:00 AM - 10:00 AM">8:00 AM - 10:00 AM</option>
          <option value="10:00 AM - 12:00 PM">10:00 AM - 12:00 PM</option>
          <option value="12:00 PM - 2:00 PM">12:00 PM - 2:00 PM</option>
          <option value="2:00 PM - 4:00 PM">2:00 PM - 4:00 PM</option>
          <option value="4:00 PM - 6:00 PM">4:00 PM - 6:00 PM</option>
          <option value="anytime">Any time that day</option>
        `;
        timeSelect.disabled = false;
        
        messageDiv.textContent = 'Unable to check availability. All time slots shown.';
        messageDiv.className = 'mt-2 text-sm text-gray-600';
        messageDiv.classList.remove('hidden');
      }
    }
    
    // Set up event listeners for real-time availability
    document.addEventListener('DOMContentLoaded', function() {
      const dateInput = document.getElementById('preferred-date');
      const serviceSelect = document.getElementById('service');
      
      if (dateInput) {
        dateInput.addEventListener('change', function() {
          const selectedDate = this.value;
          const selectedService = serviceSelect?.value || '';
          
          if (selectedDate) {
            checkAvailability(selectedDate, selectedService);
          } else {
            // Reset time select when date is cleared
            const timeSelect = document.getElementById('preferred-time');
            if (timeSelect) {
              timeSelect.innerHTML = '<option value="">First select a date to see available times</option>';
              timeSelect.disabled = true;
            }
            document.getElementById('availability-message')?.classList.add('hidden');
          }
        });
      }
      
      // Recheck availability when service type changes
      if (serviceSelect) {
        serviceSelect.addEventListener('change', function() {
          const selectedDate = dateInput?.value;
          if (selectedDate) {
            checkAvailability(selectedDate, this.value);
          }
        });
      }
    });

    document.getElementById('contact-form')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const form = e.target as HTMLFormElement;
      const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      
      // Get form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      
      // Disable submit button and show loading state
      submitButton.disabled = true;
      const originalText = submitButton.textContent;
      submitButton.textContent = 'Sending...';
      
      try {
        // Send to API endpoint
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Success - redirect to success page
          window.location.href = '/success?type=contact';
        } else {
          // Handle different types of errors
          if (result.errorCode === 'SLOT_UNAVAILABLE') {
            alert('The selected time slot is no longer available. The page will refresh to show current availability.');
            window.location.reload();
          } else if (result.errorCode === 'NO_AVAILABILITY') {
            alert(result.error || 'No available time slots found. Please select a different date.');
            // Clear the date field to force reselection
            const dateInput = document.getElementById('preferred-date');
            if (dateInput) {
              dateInput.value = '';
              const timeSelect = document.getElementById('preferred-time');
              if (timeSelect) {
                timeSelect.innerHTML = '<option value="">First select a date to see available times</option>';
                timeSelect.disabled = true;
              }
            }
          } else {
            // Generic error
            alert(result.error || 'There was an error submitting your request. Please call us at (940) 390-5676');
          }
        }
      } catch (error) {
        // Network or other error
        console.error('Form submission error:', error);
        alert('Unable to submit form. Please call us directly at (940) 390-5676');
      } finally {
        // Re-enable button
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    });
    
    // Pre-fill service if coming from schedule page
    const urlParams = new URLSearchParams(window.location.search);
    const service = urlParams.get('service');
    const serviceType = urlParams.get('type');
    
    if (service) {
      const serviceSelect = document.getElementById('service') as HTMLSelectElement;
      if (serviceSelect) {
        // Map service slugs to select options
        const serviceMap: Record<string, string> = {
          'ac-repair': 'ac-repair',
          'heating-repair': 'heating-repair',
          'furnace-repair': 'heating-repair',
          'hvac-installation': 'hvac-installation',
          'ac-installation': 'hvac-installation',
          'maintenance': 'maintenance',
          'ac-maintenance': 'maintenance',
          'emergency-ac-repair': 'emergency',
          'emergency-service': 'emergency',
          'commercial': 'commercial',
          'restaurant-hvac': 'commercial',
          'retail-hvac': 'commercial',
          'office-hvac': 'commercial',
        };
        
        const mappedService = serviceMap[service] || 'other';
        serviceSelect.value = mappedService;
        
        // If it's emergency, check the emergency box
        if (service.includes('emergency')) {
          const emergencyCheckbox = document.querySelector('input[name="emergency"]') as HTMLInputElement;
          if (emergencyCheckbox) {
            emergencyCheckbox.checked = true;
          }
        }
        
        // Add service type to message if commercial
        if (serviceType === 'commercial') {
          const messageTextarea = document.getElementById('message') as HTMLTextAreaElement;
          if (messageTextarea) {
            messageTextarea.value = `Commercial service requested: ${service.replace(/-/g, ' ')}`;
          }
        }
      }
    }
  </script>
</BaseLayout>